---
title: "HW5"
author: "Bedros, Haig; Dela Cruz, Sandra; Hugh, Tiffany; Li, Yanyi"
date: "`r Sys.Date()`"
output:
editor_options: 
  markdown: 
    wrap: 72
---
<style type="text/css">

h1.title {
  font-size: 26px;
  color: Black;
  text-align: center;
}
h4.author { 
  font-size: 18px;
  color: Black;
  text-align: center;
}
h4.date {
  font-size: 12px;
  color: Black;
  text-align: center;
}
</style>
```{r setup, include=FALSE}
knitr::opts_chunk$set(tidy.opts = list(width.cutoff = 50), tidy = TRUE, warning = FALSE)
```

```{r, include=FALSE}
library(dplyr)
library(stringr)
library(ggplot2)
library(tidyr)
library(purrr)
library(DataExplorer)
library(reshape2)
library(pROC)
library(readr)
library(caret)
library(DHARMa)
library(lares)
library(mice)
```

```{r, include=FALSE}
# Import dataset
wine_training_data <- read_csv("https://raw.githubusercontent.com/tiffhugh/DATA-621/refs/heads/main/Assignment%20%235/wine-training-data.csv")
wine_evaluation_data<- read_csv("https://raw.githubusercontent.com/tiffhugh/DATA-621/refs/heads/main/Assignment%20%235/wine-evaluation-data.csv")
```

# **Data Exploration**
First, let's remove the 'INDEX' column in both of the dataset, since we are not going to need it.
```{r, echo=FALSE}
# remove index columns
wine_training_data <- wine_training_data %>% select(-INDEX)
glimpse(wine_training_data)
dim(wine_training_data)

# do the same for evaluation data
wine_evaluation_data <- wine_evaluation_data %>% select(-IN)
```
Our wine training dataset has 12,795 observations and 15 columns. As we can see, there are a lot of data transformations that needs to be done with our variables, like cleaning our values and changing the columns into categorical values, like for `LabelAppeal` and `STARS`.

### Data Transformation of Variables
First, we clean the data by removing leading hyphens (-) from numeric values, as chemical concentrations cannot be negative, and such entries likely result from formatting errors.
```{r, echo=FALSE}
# clean the values in our variables by removing hyphens
wine_training_data <- wine_training_data %>% 
  mutate(across(-LabelAppeal, ~gsub("-", "", .x)))
glimpse(wine_training_data)

wine_evaluation_data <- wine_evaluation_data %>%
  mutate(across(-LabelAppeal, ~gsub("-", "", .x)))
```
Now that we have removed unnecessary characters in our values, let's review our distinct values.
```{r, echo=FALSE}
# check distinct values for all columns
wine_training_data %>% summarise(across(everything(), ~n_distinct(.)))

# check unique values in possibly ordinal columns
wine_training_data %>% 
  distinct(LabelAppeal, STARS) %>% 
  map(~unique(.))
```
As we can see, 'NA' is present for the `STARS` column. Later we'll impute those with values using "polr" from the MICE package, considering it's a ordinal categorical column.

Now, let's proceed with converting our columns to the appropriate data types, such as numeric, or ordinal variables:
Convert to numeric variables: `TARGET`, `FixedAcidity`, `VolatileAcidity`, `CitricAcid`, `ResidualSugar`, `Chlorides`, `FreeSulfurDioxide`, `TotalSulfurDioxide`, `Density`, `pH`, `Sulphates`, `Alcohol`, `AcidIndex`
Convert to ordinal variables: `STARS`, `LabelAppeal`
```{r, echo=FALSE}
wine_training_data <- wine_training_data %>% 
  mutate(
    # convert all numeric variables
    across(c(TARGET, FixedAcidity, VolatileAcidity, CitricAcid, 
             ResidualSugar, Chlorides, FreeSulfurDioxide, TotalSulfurDioxide, 
             Density, pH, Sulphates, Alcohol, AcidIndex), as.numeric),
    # convert all ordinal variables
    across(c(STARS, LabelAppeal), as.ordered)
  )

glimpse(wine_training_data)

# do the same for evaluation data
wine_evaluation_data <- wine_evaluation_data %>% 
  mutate(
    # convert all numeric variables
    across(c(TARGET, FixedAcidity, VolatileAcidity, CitricAcid, 
             ResidualSugar, Chlorides, FreeSulfurDioxide, TotalSulfurDioxide, 
             Density, pH, Sulphates, Alcohol, AcidIndex), as.numeric),
    # convert all ordinal variables
    across(c(STARS, LabelAppeal), as.ordered)
  )
```
### Summary of Datasets
Here we see 'NA' values with `ResidualSugar`, `Chlorides`, `FreeSulfurDioxide`, `TotalSulfurDioxide`, `pH`, `Sulphates`, `Alcohol` and `STARS`. Later we'll impute each of these missing values.

```{r, echo=FALSE}
#| fig-height: 3
#| fig-width: 8
cat("Summary of training data: \n")
summary(wine_training_data)
```
